<?php

namespace Repositories;

use Doctrine\ORM\EntityRepository;

/**
 * CustomerEquipment
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CustomerEquipment extends EntityRepository{


    /**
     * Get all the Customer equipments
     *
     * if $id is not null get the customer equipment of the provided ID
     *
     * @param   int     $id ID of customer equipment
     * @param   array   $feParams array of param to ORDER BY or not
     *
     * @return  array
     */
    public function getAll( $id = null, $feParams ){
        $dql =  "SELECT ck.id AS id, ck.name AS name, ck.descr AS descr, c.name AS customer, c.id AS custid, cab.name AS cabinet, cab.id AS cabinetid
                FROM Entities\\CustomerEquipment ck
                LEFT JOIN ck.Customer c
                LEFT JOIN ck.Cabinet cab ";

        if( $id !== null ){
            $dql .= " WHERE ck.id = ".$id;
        }

        if( isset( $feParams->listOrderBy ) ){
            $dql .= " ORDER BY ". $feParams->listOrderBy.' ';
            $dql .= isset( $feParams->listOrderByDir ) ? $feParams->listOrderByDir : 'ASC';
        }

        $query = $this->getEntityManager()->createQuery( $dql );

        return $query->getArrayResult();
    }

}
